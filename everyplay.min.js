(function(){function require(p,parent,orig){var path=require.resolve(p),mod=require.modules[path];if(null==path){orig=orig||p;parent=parent||"root";throw new Error('failed to require "'+orig+'" from "'+parent+'"')}if(!mod.exports){mod.exports={};mod.client=mod.component=true;mod.call(this,mod,mod.exports,require.relative(path))}return mod.exports}require.modules={};require.aliases={};require.resolve=function(path){var orig=path,reg=path+".js",regJSON=path+".json",index=path+"/index.js",indexJSON=path+"/index.json";return require.modules[reg]&&reg||require.modules[regJSON]&&regJSON||require.modules[index]&&index||require.modules[indexJSON]&&indexJSON||require.modules[orig]&&orig||require.aliases[index]};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,fn){require.modules[path]=fn};require.alias=function(from,to){var fn=require.modules[from];if(!fn)throw new Error('failed to alias "'+from+'", it does not exist');require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function fn(path){var orig=path;path=fn.resolve(path);return require(path,parent,orig)}fn.resolve=function(path){if("."!=path.charAt(0)){var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path}return require.normalize(p,path)};fn.exists=function(path){return!!require.modules[fn.resolve(path)]};return fn};require.register("component-url/index.js",function(module,exports,require){exports.parse=function(url){var a=document.createElement("a");a.href=url;return{href:a.href,host:a.host||location.host,port:a.port||location.port,hash:a.hash,hostname:a.hostname||location.hostname,pathname:a.pathname,protocol:!a.protocol||":"==a.protocol?location.protocol:a.protocol,search:a.search,query:a.search.slice(1)}};exports.isAbsolute=function(url){return 0==url.indexOf("//")||!!~url.indexOf("://")};exports.isRelative=function(url){return!exports.isAbsolute(url)};exports.isCrossDomain=function(url){url=exports.parse(url);return url.hostname!==location.hostname||url.port!==location.port||url.protocol!==location.protocol}});require.register("component-emitter/index.js",function(module,exports,require){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}fn._off=on;this.on(event,on);return this};Emitter.prototype.off=function(event,fn){this._callbacks=this._callbacks||{};var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var i=callbacks.indexOf(fn._off||fn);if(~i)callbacks.splice(i,1);return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("visionmedia-superagent/lib/client.js",function(module,exports,require){var Emitter=require("emitter");var root="undefined"==typeof window?this:window;function noop(){}function getXHR(){if(root.XMLHttpRequest&&("file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false}var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return str.split(/ *; */).reduce(function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(xhr,options){options=options||{};this.xhr=xhr;this.text=xhr.responseText;this.setStatusProperties(xhr.status);this.header=parseHeader(xhr.getAllResponseHeaders());this.setHeaderProperties(this.header);this.body=this.parseBody(this.text)}Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse?parse(str):null};Response.prototype.setStatusProperties=function(status){var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type;this.accepted=202==status;this.noContent=204==status||1223==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var msg="got "+this.status+" response";var err=new Error(msg);err.status=this.status;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this.set("X-Requested-With","XMLHttpRequest");this.on("end",function(){self.callback(null,new Response(self.xhr))})}Request.prototype=new Emitter;Request.prototype.constructor=Request;Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.xhr.abort();this.emit("abort");this.aborted=true;this.clearTimeout();return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this.header[field.toLowerCase()]=val;return this};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);this._query.push(val);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.header["content-type"];if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.header["content-type"];if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj)return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;if(2==fn.length)return fn(err,res);if(err)return this.emit("error",err);fn(res)};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4==xhr.readyState&&0!=xhr.status)self.emit("end")};if(timeout&&!this._timer){this._timer=setTimeout(function(){var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;self.callback(err);self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data){var serialize=request.serialize[this.header["content-type"]];if(serialize)data=serialize(data)}for(var field in this.header){xhr.setRequestHeader(field,this.header[field])}xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request});require.register("component-trim/index.js",function(module,exports,require){exports=module.exports=trim;function trim(str){return str.replace(/^\s*|\s*$/g,"")}exports.left=function(str){return str.replace(/^\s*/,"")};exports.right=function(str){return str.replace(/\s*$/,"")}});require.register("redventures-reduce/index.js",function(module,exports,require){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}});require.register("component-querystring/index.js",function(module,exports,require){var trim=require("trim"),reduce=require("reduce");exports.parse=function(str){if("string"!=typeof str)return{};str=trim(str);if(""==str)return{};return reduce(str.split("&"),function(obj,pair){var parts=pair.split("=");obj[parts[0]]=null==parts[1]?"":decodeURIComponent(parts[1]);return obj},{})};exports.stringify=function(obj){if(!obj)return"";var pairs=[];for(var key in obj){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return pairs.join("&")}});require.register("component-inherit/index.js",function(module,exports,require){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}});require.register("yields-merge/index.js",function(module,exports,require){module.exports=function(a,b){for(var k in b)a[k]=b[k];return a}});require.register("component-object/index.js",function(module,exports,require){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.values=function(obj){var vals=[];for(var key in obj){if(has.call(obj,key)){vals.push(obj[key])}}return vals};exports.merge=function(a,b){for(var key in b){if(has.call(b,key)){a[key]=b[key]}}return a};exports.length=function(obj){return exports.keys(obj).length};exports.isEmpty=function(obj){return 0==exports.length(obj)}});require.register("everyplay-js/lib/sdk.js",function(module,exports,require){var API=require("./api");var Auth=require("./auth");var Dialog=require("./dialog");var SDK=function(options){options.base=options.base||"https://api.everyplay.com";options.site=options.site||"https://everyplay.com";this.options=options;this.client_id=options.client_id;if(!this.client_id){throw new Error("client_id is requred.")}this.api=new API(this);this.auth=new Auth(this)};var SDKPrototype=SDK.prototype;SDKPrototype.get=function(path,data,callback){this.api.get(path,data,callback)};SDKPrototype.post=function(path,data,callback){this.api.post(path,data,callback)};SDKPrototype.put=function(path,data,callback){this.api.put(path,data,callback)};SDKPrototype.del=function(path,data,callback){this.api.del(path,data,callback)};SDKPrototype.accessToken=function(token){return this.auth.accessToken(token)};SDKPrototype.connect=function(cb){return this.auth.connect(cb)};var sdkSingleton=null;exports.initialize=function(options){sdkSingleton=new SDK(options);return sdkSingleton};exports.accessToken=function(token){return sdkSingleton.accessToken(token)};exports.get=function(path,data,callback){sdkSingleton.api.get(path,data,callback)};exports.post=function(path,data,callback){sdkSingleton.api.post(path,data,callback)};exports.put=function(path,data,callback){sdkSingleton.api.put(path,data,callback)};exports.del=function(path,data,callback){sdkSingleton.api.del(path,data,callback)};exports.connect=function(callback){sdkSingleton.connect(callback)};exports.Dialog=Dialog});require.register("everyplay-js/lib/api.js",function(module,exports,require){var URL=require("url");var request=require("superagent");var qs=require("querystring");var object=require("object");var everyplay=require("./sdk");var API=function(sdk){this.options=sdk.options;this.sdk=sdk;this.base=this.options.base};var APIPrototype=API.prototype;APIPrototype.get=function(path,data,callback){this.apiRequest("GET",path,data,callback)};APIPrototype.post=function(path,data,callback){this.apiRequest("POST",path,data,callback)};APIPrototype.put=function(path,data,callback){this.apiRequest("PUT",path,data,callback)};APIPrototype.del=function(path,data,callback){this.apiRequest("DELETE",path,data,callback)};APIPrototype.requestUrl=function(path,query){if(URL.isRelative(path)){path=this.base+path}var loc=URL.parse(path);if(loc.query){loc.query=qs.parse(loc.query)}else{loc.query={}}query=query||{};Object.keys(query).forEach(function(key){loc.query[key]=query[key]});var token=everyplay.accessToken();if(!token&&this.options.client_id){loc.query["client_id"]=this.options.client_id}return loc};APIPrototype.apiRequest=function(method,url,query,callback){var data;if(!callback){callback=query;query={}}url=this.requestUrl(url,query);url.query.format="json";data=url.query;url.query={};var requestUrl=url.protocol+url.host+url.pathname;var req=request[method.toLowerCase()](requestUrl);if(method!="GET"){req.send(data)}else{req.query(data)}if(everyplay.accessToken()){req.set("Authorization","Bearer "+everyplay.accessToken())}req.set("Accept","application/json");req.end(function(err,res){if(!err&&res.error){err=new Error("HTTP Error "+res.status)}return callback(err,res)})};module.exports=API});require.register("everyplay-js/lib/dialog.js",function(module,exports,require){var URL=require("url");var qs=require("querystring");var inherit=require("inherit");var merge=require("merge");var PREFIX="Everyplay_Dialog";function generateId(){return[PREFIX,Math.ceil(Math.random()*1e6).toString(16)].join("_")}function openWindow(url,options){options=options||{};options.url=url;options=merge(options,{location:url,left:window.screenX+(window.outerWidth-options.width)/2,top:window.screenY+(window.outerHeight-options.height)/2,scrollbars:"yes"});var opts=[];for(var i in options){if(options.hasOwnProperty(i)){opts.push(i+"="+options[i])}}return window.open(url,options.name,opts.join(", "))}function getDialogFromWindow(window){var loc=URL.parse(window.location.toString());loc.query=qs.parse(loc.query);if(loc.hash&&loc.hash.length){loc.hash=qs.parse(loc.hash.substring(1))}var id=loc.query.state||loc.hash.state;if(this.isDialogId(id)){return id}return null}function isDialogId(id){(id||"").match(new RegExp("^"+PREFIX))}var Dialog=function(options,sdk){if(typeof options=="function"){callback=options;options={}}this.params=[];this.sdk=sdk;this.options=sdk.options;this.dialogOptions=options;this.callback=options.callback;this.base=this.options.base;this.site=this.options.site;this.id=generateId()};var DialogPrototype=Dialog.prototype;DialogPrototype.paramsFromWindow=function(window){var params={};var loc=URL.parse(window.location.toString());loc.query=qs.parse(loc.query);if(loc.hash&&loc.hash.length){loc.hash=qs.parse(loc.hash.substring(1))}if(loc.hash){params=merge(params,loc.hash)}if(loc.query){params=merge(params,loc.query)}return params};DialogPrototype.handleReturn=function(window){var params=this.paramsFromWindow();if(this.dialogOptions.window&&!this.dialogOptions.retain){this.dialogOptions.window.close()}if(this.callback){return this.callback(params)}};DialogPrototype.url=function(path){var self=this;if(URL.isRelative(path)){path=this.options.base+path}var query={};this.params.forEach(function(key){if(self.dialogOptions[key]){query[key]=self.dialogOptions[key]}});path+="?"+qs.stringify(query);return path};DialogPrototype.open=function(){var url=this.url(this.site+this.path);if(this.dialogOptions.window){this.dialogOptions.window.location=url}else{this.dialogOptions.window=openWindow(url,this.dialogOptions)}};var ConnectDialog=function(options,sdk){Dialog.call(this,options,sdk);this.name="connect";this.path="/connect";this.params=["client_id","redirect_uri","state","response_type","scope","display"];this.dialogOptions.width=320;this.dialogOptions.height=480};ConnectDialogPrototype=ConnectDialog.prototype;ConnectDialogPrototype.buildURL=function(){};inherit(ConnectDialog,Dialog);var dialogs={};exports.dialogs={Connect:ConnectDialog};exports.dialog=function(sdk,name,options,callback){options.callback=callback;var dialog=new exports.dialogs[name](options,sdk);dialogs[dialog.id]=dialog;dialog.open();return dialog};exports.handle=function(){var id=getDialogFromWindow(window);if(id){var ios=navigator.userAgent.match(/OS 5(_\d)+ like Mac OS X/i);if(ios){window.opener.EP.Dialog.handleReturn(window)}else if(window.opener){window.opener.setTimeout(function(){window.opener.EP.Dialog.handleReturn(window)},1)}else if(window.top){window.top.setTimeout(function(){window.top.EP.Dialog.handleReturn(window)},1)}}};exports.handleReturn=function(window){var id=getDialogFromWindow(window);if(id){var dialog=dialogs[id];if(dialog){dialog.handleReturn();delete dialogs[id]}}}});require.register("everyplay-js/lib/auth.js",function(module,exports,require){var Dialog=require("./dialog");var Auth=function(sdk){this.storage=window.localStorage;this.sdk=sdk;this.options=sdk.options;this.token=this.storage.getItem("EP.accessToken");this.dialogOptions={client_id:this.options.client_id,redirect_uri:this.options.redirect_uri,response_type:"token",scope:this.options.scope||"basic",display:"popup",window:this.options.window,retain:this.options.retain};this.dialogWindow=null};var AuthPrototype=Auth.prototype;AuthPrototype.accessToken=function(token){if(token===undefined&&this.token!==undefined){return this.token}if(token===null){this.token=undefined;return this.storage.removeItem("EP.accessToken")}else if(token===undefined){this.token=this.storage.getItem("EP.accessToken");return this.token}else{this.token=token;return this.storage.setItem("EP.accessToken",token)}};AuthPrototype.connect=function(cb){var self=this;if(this.connected()){return cb(null,this.accessToken())}this.dialog=Dialog.dialog(this.sdk,"Connect",this.dialogOptions,function(err,params){if(err||params.error){err=err||new Error("OAuth2 error:"+params.error+" description:"+params.error_description)}if(params.access_token){self.accessToken(params.access_token)}return cb(err,self.accessToken())});this.dialogWindow=this.dialog.options.window};AuthPrototype.connected=function(){return this.accessToken()!=null};module.exports=Auth});require.alias("component-url/index.js","everyplay-js/deps/url/index.js");require.alias("visionmedia-superagent/lib/client.js","everyplay-js/deps/superagent/lib/client.js");require.alias("visionmedia-superagent/lib/client.js","everyplay-js/deps/superagent/index.js");require.alias("component-emitter/index.js","visionmedia-superagent/deps/emitter/index.js");require.alias("component-querystring/index.js","everyplay-js/deps/querystring/index.js");require.alias("component-trim/index.js","component-querystring/deps/trim/index.js");require.alias("redventures-reduce/index.js","component-querystring/deps/reduce/index.js");require.alias("component-inherit/index.js","everyplay-js/deps/inherit/index.js");require.alias("yields-merge/index.js","everyplay-js/deps/merge/index.js");require.alias("component-object/index.js","everyplay-js/deps/object/index.js");require.alias("everyplay-js/lib/sdk.js","everyplay-js/index.js");if("undefined"==typeof module){window.everyplay=require("everyplay-js")}else{module.exports=require("everyplay-js")}})();